{% extends "base.html" %} {% block title %}Food Donation & Charity Locations -
Food Wastage Manager{% endblock %} {% block extra_css %}
<style>
  .donation-container {
    max-width: 1200px;
    margin: 2rem auto;
    padding: 2rem;
  }

  .map-container {
    height: 500px;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    margin-bottom: 2rem;
  }

  .charity-list {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    padding: 1rem;
  }

  .charity-card {
    border: 1px solid #eee;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
    transition: transform 0.2s;
  }

  .charity-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  .charity-type {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.875rem;
    background-color: #e9ecef;
    color: #495057;
    margin-right: 0.5rem;
  }

  .charity-stats {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
    font-size: 0.875rem;
    color: #6c757d;
  }

  .donation-form {
    background: white;
    border-radius: 8px;
    padding: 1.5rem;
    margin-top: 2rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .food-type-tag {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    background-color: #e9ecef;
    color: #495057;
    margin: 0.25rem;
    font-size: 0.875rem;
  }
</style>
{% endblock %} {% block content %}
<div class="donation-container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="mb-2">Food Donation & Charity Locations</h1>
      <p class="text-muted">
        Find nearby food banks, charities and NGOs where you can donate your
        excess food
      </p>
    </div>
    <button
      class="btn btn-primary"
      data-bs-toggle="modal"
      data-bs-target="#donationModal"
    >
      <i class="bi bi-plus-circle me-2"></i>Schedule Donation
    </button>
  </div>

  <div class="row">
    <div class="col-md-8">
      <div class="map-container" id="donation-map"></div>
    </div>
    <div class="col-md-4">
      <div class="charity-list">
        <h4 class="mb-3">Nearby Food Charities</h4>
        <div id="donation-list">
          <!-- Charities will be listed here -->
        </div>
      </div>
    </div>
  </div>

  <div class="donation-form">
    <h4 class="mb-3">What can you donate?</h4>
    <div class="mb-4">
      <div class="food-type-tag">Non-perishable foods</div>
      <div class="food-type-tag">Fresh produce</div>
      <div class="food-type-tag">Canned goods</div>
      <div class="food-type-tag">Packaged meals</div>
      <div class="food-type-tag">Beverages</div>
      <div class="food-type-tag">Grains & cereals</div>
    </div>
    <p class="text-muted">
      <i class="bi bi-info-circle me-2"></i>
      All donations must meet food safety guidelines. Please ensure items are
      properly packaged and not expired.
    </p>
  </div>
</div>

<!-- Donation Modal -->
<div class="modal fade" id="donationModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Schedule Food Donation</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <div class="modal-body">
        <form id="donationForm">
          <div class="mb-3">
            <label class="form-label">Select Charity</label>
            <select class="form-select" id="charitySelect" required>
              <!-- Will be populated dynamically -->
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Food Items</label>
            <textarea
              class="form-control"
              rows="3"
              placeholder="List the items you want to donate"
              required
            ></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Preferred Pickup Date</label>
            <input type="date" class="form-control" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Additional Notes</label>
            <textarea
              class="form-control"
              rows="2"
              placeholder="Any special instructions or notes"
            ></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-primary"
          onclick="submitDonation()"
        >
          Schedule Donation
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places"></script>
<script>
  let map;
  let markers = [];
  let charities = [];

  function initMap() {
    map = new google.maps.Map(document.getElementById("donation-map"), {
      zoom: 13,
      center: { lat: 16.5157, lng: 80.6304 }, // Coordinates for Vijayawada
    });

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition((position) => {
        const userLocation = {
          lat: position.coords.latitude,
          lng: position.coords.longitude,
        };
        map.setCenter(userLocation);

        // Add user marker
        new google.maps.Marker({
          position: userLocation,
          map: map,
          icon: {
            path: google.maps.SymbolPath.CIRCLE,
            scale: 10,
            fillColor: "#4285F4",
            fillOpacity: 1,
            strokeWeight: 2,
            strokeColor: "#ffffff",
          },
          title: "Your Location",
        });

        searchNearbyCharities(userLocation);
      });
    }
  }

  function searchNearbyCharities(location) {
    const service = new google.maps.places.PlacesService(map);
    service.nearbySearch(
      {
        location: location,
        radius: 5000,
        keyword: ["food bank", "food donation", "charity", "NGO"],
      },
      (results, status) => {
        if (status === google.maps.places.PlacesServiceStatus.OK) {
          charities = results;
          clearMarkers();
          const donationList = document.getElementById("donation-list");
          const charitySelect = document.getElementById("charitySelect");

          donationList.innerHTML = "";
          charitySelect.innerHTML =
            '<option value="">Select a charity...</option>';

          results.forEach((place, index) => {
            addMarker(place);
            addToList(place, location);

            // Add to modal select
            charitySelect.innerHTML += `
            <option value="${index}">${place.name}</option>
          `;
          });
        }
      }
    );
  }

  function addMarker(place) {
    const marker = new google.maps.Marker({
      position: place.geometry.location,
      map: map,
      title: place.name,
      icon: {
        url: "https://maps.google.com/mapfiles/ms/icons/red-dot.png",
      },
    });

    const infoWindow = new google.maps.InfoWindow({
      content: `
        <div style="padding: 10px;">
          <h5 style="margin: 0 0 5px;">${place.name}</h5>
          <p style="margin: 0;">${place.vicinity}</p>
        </div>
      `,
    });

    marker.addListener("click", () => {
      infoWindow.open(map, marker);
    });

    markers.push(marker);
  }

  function addToList(place, userLocation) {
    const directionsService = new google.maps.DirectionsService();
    directionsService.route(
      {
        origin: userLocation,
        destination: place.geometry.location,
        travelMode: "DRIVING",
      },
      (response, status) => {
        if (status === "OK") {
          const route = response.routes[0];
          const distance = route.legs[0].distance.text;
          const duration = route.legs[0].duration.text;

          const donationList = document.getElementById("donation-list");
          donationList.innerHTML += `
          <div class="charity-card">
            <h5 class="mb-2">${place.name}</h5>
            <p class="mb-2">${place.vicinity}</p>
            <div class="charity-type">Food Bank</div>
            <div class="charity-stats">
              <span><i class="bi bi-geo-alt me-1"></i>${distance}</span>
              <span><i class="bi bi-clock me-1"></i>${duration}</span>
            </div>
          </div>
        `;
        }
      }
    );
  }

  function clearMarkers() {
    markers.forEach((marker) => marker.setMap(null));
    markers = [];
  }

  function submitDonation() {
    // Here you would handle the donation submission
    // For now, just show a success message
    const modal = bootstrap.Modal.getInstance(
      document.getElementById("donationModal")
    );
    modal.hide();

    // Show success alert
    const alert = document.createElement("div");
    alert.className = "alert alert-success alert-dismissible fade show";
    alert.innerHTML = `
      <i class="bi bi-check-circle me-2"></i>
      Your donation has been scheduled successfully!
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    document.querySelector(".donation-container").prepend(alert);
  }

  // Initialize map when page loads
  document.addEventListener("DOMContentLoaded", initMap);
</script>
{% endblock %}
